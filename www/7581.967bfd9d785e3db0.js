"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7581],{7581:(N,y,d)=>{d.r(y),d.d(y,{ValuePageModule:()=>Z});var C=d(9808),_=d(4182),l=d(5056),b=d(2292),m=d(655),e=d(2096),V=d(1414),U=d(3293),w=d(4811),T=d(7011);function D(a,g){1&a&&e._UZ(0,"ion-datetime",22)}function R(a,g){1&a&&e._UZ(0,"ion-datetime",23)}const u="6e400001-b5a3-f393-e0a9-e50e24dc4179",v="6e400003-b5a3-f393-e0a9-e50e24dc4179",c="6e400002-b5a3-f393-e0a9-e50e24dc4179",f="110433343435",S="110433353435",x="110433363435",P=[{path:"",component:(()=>{class a{constructor(t,r,s,i,n,o,h,A,p,k){this.navCtrl=t,this.activatedRoute=r,this.bleService=s,this.chartService=i,this.globalData=n,this.router=o,this.ble=h,this.alertCtrl=A,this.toastCtrl=p,this.ngZone=k,this.lablesList=["","","","","","","",""],this.listdata_A=[],this.listdata_B=[],this.listdata_C=[],this.chartName="\u7535\u538b\u66f2\u7ebf",this.datasets=[{key:"A",data:this.listdata_A,backgroundColor:"rgba(255, 255, 0, 0.2)",borderColor:"rgba(255, 255, 0, 1)"},{key:"B",data:this.listdata_B,backgroundColor:"rgba(0, 255, 0, 0.2)",borderColor:"rgba(0, 255, 0, 1)"},{key:"C",data:this.listdata_C,backgroundColor:"rgba(255, 0, 0, 0.2)",borderColor:"rgba(255, 0, 0, 1)"}],this.time=new Date(null),this.peripheral={},this.resultStringArray=[],this.i=0,this.actionflag=0,this.addressflag=!1,this.requestMTUflag=!1,this.deviceAddress=[];const B=this.router.getCurrentNavigation().extras.state.device;this.device=B,this.bleService.setNotificationCallback(M=>{this.onTemperatureChange(M)}),this.bleService.startNotification(this.device.id,u,v)}ngOnDestroy(){console.log("Method not implemented.")}ngOnInit(){this.updatedRootaddress=this.globalData.getData("DeviceID"),console.log(this.updatedRootaddress),this.calculateCS()}onTemperatureChange(t){console.log("Handle received data: ");const r=new Uint8Array(t[0]);if(this.resultStringArray=this.uint8ArrayToHexArray(r),console.log("resultStringArray:"+this.resultStringArray),"34"==this.resultStringArray[this.resultStringArray.length-7]&&"91"==this.resultStringArray[this.resultStringArray.length-10])this.ngZone.run(()=>{this.voltage_A=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-3],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[0]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[1]}),console.log("ywd:"+this.voltage_A);else if("35"==this.resultStringArray[this.resultStringArray.length-7]&&"91"==this.resultStringArray[this.resultStringArray.length-10])this.ngZone.run(()=>{this.voltage_B=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-3],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[1]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[0]}),console.log("ywd:"+this.voltage_A);else if("36"==this.resultStringArray[this.resultStringArray.length-7]&&"91"==this.resultStringArray[this.resultStringArray.length-10])this.ngZone.run(()=>{this.voltage_C=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-3],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[1]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[0]});else if("32"==this.resultStringArray[this.resultStringArray.length-11]&&"91"==this.resultStringArray[this.resultStringArray.length-14]){const s=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-7],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-8],"33")[0]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-8],"33")[1],i=parseFloat(s);if(this.listdata_A.push(i),"32"!=this.resultStringArray[this.resultStringArray.length-6]){const n=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-5],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-6],"33")[0]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-6],"33")[1],o=this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-3],"33")+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[0]+"."+this.subtractHexValue(this.resultStringArray[this.resultStringArray.length-4],"33")[1],h=parseFloat(n);this.listdata_B.push(h);const A=parseFloat(o);if(this.listdata_C.push(A),8==this.listdata_A.length&&8==this.listdata_B.length&&8==this.listdata_C.length){for(let p=0;p<3;p++)console.log(this.datasets[p].data);this.chartService.single(this.datasets,this.lablesList,"line-chart","line"),this.listdata_A=[],this.listdata_B=[],this.listdata_C=[]}}else 8==this.listdata_A.length&&(this.chartService.single(this.datasets,this.lablesList,"line-chart","line"),this.listdata_A=[])}this.resultStringArray=[]}calculateCS(){this.cs4va=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+f).toUpperCase(),this.cs4vb=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+S).toUpperCase(),this.cs4vc=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+x).toUpperCase(),this.readva=this.updatedRootaddress+f+this.cs4va+"16",this.readvb=this.updatedRootaddress+S+this.cs4vb+"16",this.readvc=this.updatedRootaddress+x+this.cs4vc+"16";const t=this.hexStringToUint8Array(this.readva),r=this.hexStringToUint8Array(this.readvb),s=this.hexStringToUint8Array(this.readvc);this.ble.writeWithoutResponse(this.device.id,u,c,t.buffer),this.ble.writeWithoutResponse(this.device.id,u,c,r.buffer),this.ble.writeWithoutResponse(this.device.id,u,c,s.buffer)}subtractHexValue(t,r){const s=parseInt(t,16),i=parseInt(r,16);return s-i<0?(s-s).toString(16).toUpperCase():(s-i).toString(16).toUpperCase()}addStringNumber(t,r){return(parseInt(t,16)+parseInt(r,16)).toString(16).toUpperCase()}onDeviceDisconnected(t){return(0,m.mG)(this,void 0,void 0,function*(){(yield this.toastCtrl.create({message:"\u8bbe\u5907\u5df2\u65ad\u5f00",duration:5e3,position:"middle"})).present()})}uint8ArrayToHexArray(t){const r=[];for(let s=0;s<t.length;s++)r.push(t[s].toString(16).padStart(2,"0"));return r}hexStringToUint8Array(t){if(t.length%2!=0)throw new Error("Hexadecimal string must have an even length");const r=[];for(let s=0;s<t.length;s+=2){const i=t.substring(s,s+2),n=parseInt(i,16);if(isNaN(n))throw new Error(`Invalid hexadecimal number at position ${s}: ${i}`);r.push(n)}return new Uint8Array(r)}convertDecimalArrayToHexString(t){const r=this.reverseString(t.join(""));return parseInt(r,10).toString(16).toUpperCase()}stringToAsciiUint8Array(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}convertUint8ArrayToString(t){let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}extractAndReverseBetween68s(t){const s=t.match(/68(.*?)68/);return s&&s[1]?this.reverseString(s[1]):null}reverseString(t){let r="";t.length%2!=0&&(r+=t.charAt(t.length-1));for(let s=0;s<t.length-1;s+=2)r=t.substring(s,s+2)+r;return r}convertStringToHexArray(t){if(t.length%2!=0)throw new Error("Input string must have an even number of characters");const r=[];for(let s=0;s<t.length;s+=2){const i=t.substring(s,s+2);if(!/^[0-9A-Fa-f]{2}$/.test(i))throw new Error("Input string contains invalid hexadecimal numbers");r.push(i.toUpperCase())}return r}sumHexValuesAndKeep8Bits(t){const r=t.match(/.{1,2}/g);if(!r)throw new Error("Invalid hex string");let s=0;return r.forEach(n=>{const o=parseInt(n,16);if(isNaN(o))throw new Error(`Invalid hex value encountered: ${n}`);s+=o}),(255&s).toString(16).padStart(2,"0")}startdate(){const t=document.getElementById("datetimea");if(t){const r=t.value;if("string"==typeof r){const s=r.split("T")[0],[i,n,o]=s.split("-");this.lablesList[0]=n+"/"+o;const h=i.slice(-2);this.startDate=this.addStringNumber(o,"33")+this.addStringNumber(n,"33")+this.addStringNumber(h,"33")}else{const s=(new Date).toISOString().split("T")[0],[i,n,o]=s.split("-");this.lablesList[0]=n+"/"+o;const h=i.slice(-2);this.startDate=this.addStringNumber(o,"33")+this.addStringNumber(n,"33")+this.addStringNumber(h,"33")}console.log("startdate:",this.startDate)}}enddate(){const t=document.getElementById("datetimeb");if(t){const r=t.value;if("string"==typeof r){const s=r.split("T")[0],[i,n,o]=s.split("-");this.lablesList[this.lablesList.length-1]=n+"/"+o;const h=i.slice(-2);this.endDate=this.addStringNumber(o,"33")+this.addStringNumber(n,"33")+this.addStringNumber(h,"33")}else{const s=(new Date).toISOString().split("T")[0];this.lablesList[this.lablesList.length-1]=s;const[i,n,o]=s.split("-");this.lablesList[this.lablesList.length-1]=n+"/"+o;const h=i.slice(-2);this.endDate=this.addStringNumber(o,"33")+this.addStringNumber(n,"33")+this.addStringNumber(h,"33")}console.log("enddate:",this.endDate)}}showcurve(){if(this.startdate(),this.enddate(),this.startDate==this.endDate)for(let t=0;t<8;t++)this.cs4curve=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+"110A333234353433"+(33+3*t).toString()+this.startDate).toUpperCase(),console.log(this.updatedRootaddress+"110A333234353433"+(33+3*t).toString()+this.startDate+this.cs4curve+"16"),this.ble.writeWithoutResponse(this.device.id,u,c,this.hexStringToUint8Array(this.updatedRootaddress+"110A333234353433"+(33+3*t).toString()+this.startDate+this.cs4curve+"16").buffer),this.timeout(50);else{for(let t=0;t<4;t++)this.cs4curve=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.startDate).toUpperCase(),console.log(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.startDate+this.cs4curve+"16"),this.ble.writeWithoutResponse(this.device.id,u,c,this.hexStringToUint8Array(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.startDate+this.cs4curve+"16").buffer),this.timeout(20);for(let t=0;t<4;t++)this.cs4curve=this.sumHexValuesAndKeep8Bits(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.endDate).toUpperCase(),console.log(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.endDate+this.cs4curve+"16"),this.ble.writeWithoutResponse(this.device.id,u,c,this.hexStringToUint8Array(this.updatedRootaddress+"110A333234353433"+(33+6*t).toString()+this.endDate+this.cs4curve+"16").buffer),this.timeout(20)}}resetdate(){this.listdata_A=[],this.listdata_B=[],this.listdata_C=[],this.chartService.destroy()}ionViewWillLeave(){this.bleService.stopNotification(this.peripheral.id,u,v)}ionViewWillEnter(){this.dataSubscription&&this.dataSubscription.unsubscribe()}readaddressAlert(){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({cssClass:"my-custom-class",header:"\u6e29\u99a8\u63d0\u793a",subHeader:"",message:"\u8bf7\u5148\u8bfb\u8868\u53f7",buttons:["OK"]})).present()})}presentreadAlert(){return(0,m.mG)(this,void 0,void 0,function*(){yield(yield this.alertCtrl.create({cssClass:"my-custom-class",header:"\u6e29\u99a8\u63d0\u793a",subHeader:"",message:"\u6570\u636e\u4f20\u8f93\u9519\u8bef",buttons:["OK"]})).present()})}setStatus(t){console.log(t),this.ngZone.run(()=>{this.statusMessage=t})}onDeviceReady(){console.log(navigator.notification)}alertDismissed(){console.log("it is OK")}dec(t,r){const s=Math.pow(10,r);return Math.round(t*s)/s}timeout(t){return new Promise(r=>setTimeout(r,t))}delay(){console.log("delay")}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(l.SH),e.Y36(b.gz),e.Y36(V.x),e.Y36(U.C),e.Y36(w.v),e.Y36(b.F0),e.Y36(T.I),e.Y36(l.Br),e.Y36(l.yF),e.Y36(e.R0b))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-value"]],decls:40,vars:5,consts:[[1,"fixed-content"],[1,"coverhead"],[1,"tophead"],[1,"headtxt"],[1,"rectangle"],[1,"mycanvas"],["id","line-chart","width","333","height","191"],[1,"mydate"],[2,"font-size","12px"],["datetime","datetimea",2,"font-size","12px"],[3,"keepContentsMounted"],["datetime","datetimeb",2,"font-size","12px"],[1,"myselect"],[2,"width","155px","float","left","margin","0 20px",3,"click"],[2,"width","155px","float","right","margin","0 20px",3,"click"],[1,"footer-content"],[1,"home-button"],[1,"report-button"],[1,"user-button"],["src","/assets/img/\u9996\u9875\u5b57.png",1,"home"],["src","/assets/img/\u62a5\u8868\u5b57.png",1,"report"],["src","/assets/img/\u7528\u6237\u5b57.png",1,"user"],["id","datetimea","presentation","date",2,"font-size","12px"],["id","datetimeb","presentation","date",2,"font-size","12px"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-content")(1,"div",0),e._UZ(2,"div",1)(3,"div",2),e.TgZ(4,"div",3),e._uU(5,"\u84dd\u7259\u7535\u8868"),e.qZA(),e.TgZ(6,"div",4)(7,"span"),e._uU(8),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA(),e.TgZ(11,"span"),e._uU(12),e.qZA()(),e.TgZ(13,"div",5),e._UZ(14,"canvas",6),e.qZA(),e.TgZ(15,"div",7)(16,"ion-label",8),e._uU(17,"\u65f6\u95f4\uff1a"),e.qZA(),e._UZ(18,"ion-datetime-button",9),e.TgZ(19,"ion-modal",10),e.YNc(20,D,1,0,"ng-template"),e.qZA(),e.TgZ(21,"ion-label"),e._uU(22,"\uff5e"),e.qZA(),e._UZ(23,"ion-datetime-button",11),e.TgZ(24,"ion-modal",10),e.YNc(25,R,1,0,"ng-template"),e.qZA()(),e.TgZ(26,"div",12)(27,"ion-button",13),e.NdJ("click",function(){return r.resetdate()}),e._uU(28,"\u6e05\u9664"),e.qZA(),e.TgZ(29,"ion-button",14),e.NdJ("click",function(){return r.showcurve()}),e._uU(30,"\u67e5\u8be2"),e.qZA()()()(),e.TgZ(31,"ion-footer")(32,"ion-toolbar")(33,"div",15),e._UZ(34,"ion-button",16)(35,"ion-button",17)(36,"ion-button",18)(37,"ion-img",19)(38,"ion-img",20)(39,"ion-img",21),e.qZA()()()),2&t&&(e.xp6(8),e.Oqu(r.voltage_A),e.xp6(2),e.Oqu(r.voltage_B),e.xp6(2),e.Oqu(r.voltage_C),e.xp6(7),e.Q6J("keepContentsMounted",!0),e.xp6(5),e.Q6J("keepContentsMounted",!0))},dependencies:[l.YG,l.W2,l.x4,l.Mj,l.fr,l.Xz,l.Q$,l.sr,l.ki,l.QI],styles:['@charset "UTF-8";.fixed-content[_ngcontent-%COMP%]{position:fixed;top:0;width:100%}ion-content[_ngcontent-%COMP%]{opacity:1;--overflow: hidden;--background: rgba(244, 248, 251, 1)}ion-button[_ngcontent-%COMP%]{--box-shadow: none;--outline-style: none}ion-button[_ngcontent-%COMP%]:hover, ion-button[_ngcontent-%COMP%]:active{opacity:.9}.headtxt[_ngcontent-%COMP%]{display:flex;position:absolute;z-index:3;top:30px;justify-content:center;width:100%;font-size:20px;font-weight:500;letter-spacing:0px;line-height:23.44px;color:#06211a}.tophead[_ngcontent-%COMP%]{left:0;top:0;width:100%;height:476px;position:absolute;z-index:2;opacity:.6;background:linear-gradient(166.95deg,rgb(148,191,255) 0%,rgb(227,230,250) 46.69%,rgb(244,248,251) 100%)}.coverhead[_ngcontent-%COMP%]{display:flex;position:relative;z-index:1;left:0;right:0;top:0;width:100%;height:467px;opacity:1;background:url(/assets/img/bg.png) no-repeat center center;background-size:cover}.rectangle[_ngcontent-%COMP%]{background:url(/assets/img/voltage.png) no-repeat center center;background-size:cover;display:grid;grid-template-columns:repeat(1,1fr);grid-template-rows:repeat(3,auto);gap:5px;justify-items:center;align-items:center;padding:24px;position:absolute;z-index:4;top:108px;left:50%;transform:translate(-50%);width:335px;height:223px;opacity:1;border-radius:10px}span[_ngcontent-%COMP%]{position:relative;top:12px;left:75px;color:#00f;font-size:15px}.mycanvas[_ngcontent-%COMP%]{background:white;background-size:cover;position:absolute;z-index:4;top:343px;left:50%;transform:translate(-50%);width:335px;height:191px;opacity:1;border-radius:10px}.mydate[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white;background-size:cover;position:absolute;z-index:4;top:551px;left:50%;transform:translate(-50%);width:333px;height:56px;opacity:1;border-radius:5px}.myselect[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:transparent;background-size:cover;position:absolute;z-index:4;top:620px;left:50%;transform:translate(-50%);width:333px;height:40px;opacity:1;border-radius:5px}.footer-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(2,auto);gap:5px;justify-items:center;align-items:center;padding:10px;height:70px}.home-button[_ngcontent-%COMP%]{--background: url(/assets/img/\\9996\\9875.png) no-repeat center center / cover;width:28px;height:28px;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;background-size:contain;background-position:center;background-repeat:no-repeat;border:none}.report-button[_ngcontent-%COMP%]{--background: url(/assets/img/\\62a5\\8868.png) no-repeat center center / cover;width:28px;height:28px;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;background-size:contain;background-position:center;background-repeat:no-repeat;border:none}.user-button[_ngcontent-%COMP%]{--background: url(/assets/img/\\7528\\6237.png) no-repeat center center / cover;width:24px;height:24px;--padding-start: 0;--padding-end: 0;--padding-top: 0;--padding-bottom: 0;background-size:contain;background-position:center;background-repeat:no-repeat;border:none}']}),a})()}];let H=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[b.Bz.forChild(P),b.Bz]}),a})(),Z=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[C.ez,_.u5,l.Pc,H]}),a})()}}]);